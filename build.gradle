task compileWebsite(type: Exec) {
    executable "bash"
    args "-c", '''
        cd website
        lektor build --output-path ../build --prune
    '''
}

task compileManuals(type: Exec) {
    executable "bash"
    args "-c", '''
        find . -name "*.adoc" | xargs -n 1 asciidoctor
    '''

    dependsOn compileWebsite
}

task testCompileManuals(type: Exec) {
    executable "bash"
    args "-c", "asciidoctor tutorials/**/*.adoc"
}

task build {
    group = 'Lektor'
    description = 'Compile the HTML files for the website'

    dependsOn compileManuals
    dependsOn compileWebsite
}

task publish(type: Exec) {
    group = 'Lektor'

    executable "bash"
    args "-c", '''
        rsync -r build/ www.experimental-software.com@ssh.strato.de:raspberrypi-tutorials
    '''

    dependsOn build
}

task test(type: Exec) {
    group = 'Lektor'
    description = 'Run a local server for testing the website'

    executable "bash"
    args "-c", "cd website && lektor serve"

    dependsOn testCompileManuals
}

task clean(type: Exec) {
    group = 'Lektor'
    description = 'Delete the compiled website'

    executable "bash"
    args "-c", "rm -r build/"
}
